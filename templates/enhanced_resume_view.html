{% extends 'base.html' %}

{% block title %}AI Resume Enhancement - Career Coach{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-900 text-white">

  <!-- Model Selection Section (added) -->
  <div class="max-w-7xl mx-auto py-8 px-6">
    <form method="POST" action="{{ url_for('upload_resume') }}" enctype="multipart/form-data" class="flex items-center gap-4">
      <label for="model" class="text-lg font-semibold text-white">Choose AI Model:</label>
      <select name="model" id="model" class="rounded-md px-3 py-2 bg-gray-800 text-white border border-gray-600 hover:border-green-500 focus:outline-none focus:ring-2 focus:ring-green-500" required>
        <option value="gpt-4.1-mini" {% if selected_model == 'gpt-4.1-mini' %}selected{% endif %}>GPT-4.1 Mini</option>
        <option value="gpt-4o-mini" {% if selected_model == 'gpt-4o-mini' or not selected_model %}selected{% endif %}>GPT-4.0 Mini</option>
      </select>
      <!-- You can add other inputs here or a hidden submit, depending on your flow -->
    </form>
  </div>

  <!-- Professional Header Section -->
  <div class="bg-gradient-to-r from-green-800 via-green-700 to-blue-800 py-20 px-6">
    <div class="max-w-7xl mx-auto text-center">
      <div class="inline-flex items-center justify-center w-24 h-24 bg-white rounded-full mb-8 animate-pulse">
        <svg class="w-12 h-12 text-green-600" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
      </div>
      <h1 class="text-6xl md:text-7xl font-bold text-white mb-6 leading-tight">
        🎉 Resume Enhancement
        <span class="block text-green-300 mt-2">Complete!</span>
      </h1>
      <p class="text-2xl md:text-3xl text-green-100 max-w-4xl mx-auto leading-relaxed">
        Your resume has been professionally enhanced. Now choose your preferred template and download your job-ready resume.
      </p>
    </div>
  </div>

  <!-- AI Processing Demonstration Section -->
  <div class="bg-gray-800 py-16 px-6">
    <div class="max-w-7xl mx-auto">
      <div class="text-center mb-12">
        <h2 class="text-4xl font-bold text-white mb-6">AI Enhancement Process</h2>
        <p class="text-xl text-gray-400 max-w-3xl mx-auto">Watch how AI analyzed and improved your resume content</p>
      </div>
      <div class="bg-gray-900 rounded-2xl border border-green-600 p-10 shadow-2xl">
        <div class="flex items-center mb-8">
          <div class="w-5 h-5 bg-green-500 rounded-full mr-4 animate-ping"></div>
          <span class="text-green-400 font-semibold text-lg">AI Enhancement Complete!</span>
        </div>
        <div class="bg-black rounded-xl p-8 font-mono text-base">
          <div class="text-green-400 mb-6 text-lg">
            <span class="text-gray-500">$</span> ai-enhance-resume --worldwide-professional --templates
          </div>
          <div id="typing-container" class="text-gray-300 leading-relaxed min-h-[200px]"></div>
          <span id="cursor" class="text-green-400 animate-pulse text-lg">|</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Template Selection Section -->
  <div class="bg-gray-800 py-20 px-6">
    <div class="max-w-7xl mx-auto">
      <div class="text-center mb-16">
        <h2 class="text-5xl font-bold text-white mb-6">Choose Your Professional Template</h2>
        <p class="text-xl text-gray-400 max-w-3xl mx-auto">AI has prepared your enhanced content. Select your preferred template style and color scheme to create your perfect resume.</p>
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-12 mb-16">

        <!-- Professional Template -->
        <div class="bg-gray-900 rounded-3xl p-8 border-2 border-blue-600 hover:border-blue-400 transition-all duration-300 transform hover:scale-105">
          <div class="mb-8">
            <h3 class="text-3xl font-bold text-blue-400 mb-4">Professional Template</h3>
            <p class="text-gray-300 text-lg leading-relaxed">Clean, corporate design perfect for traditional industries, finance, consulting, and executive positions.</p>
          </div>
          <div class="bg-white rounded-xl p-6 mb-8 h-80 overflow-hidden shadow-lg">
            <div class="bg-blue-800 text-white p-4 rounded-t-lg text-center">
              <div class="flex items-center justify-center">
                {% if resume.photo_path %}
                <div class="w-16 h-16 bg-gray-300 rounded-full mr-4"></div>
                {% endif %}
                <div>
                  <div class="font-bold text-lg">PROFESSIONAL NAME</div>
                  <div class="text-sm opacity-90">professional@email.com</div>
                </div>
              </div>
            </div>
            <div class="p-4 text-gray-800 text-sm">
              <div class="font-bold border-b-2 border-blue-200 pb-2 mb-3">PROFESSIONAL SUMMARY</div>
              <div class="text-gray-600 mb-4 text-xs leading-relaxed">{{ resume.text_content|truncate(120) }}</div>
              <div class="font-bold border-b-2 border-blue-200 pb-2 mb-3">EXPERIENCE</div>
              <div class="text-gray-600 text-xs">Enhanced professional experience with quantified achievements...</div>
            </div>
          </div>
          <div class="space-y-4">
            <button onclick="downloadTemplate('professional', 'color')" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold py-4 px-8 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg">
              🎨 Download with Professional Colors
            </button>
            <button onclick="downloadTemplate('professional', 'bw')" class="w-full bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-bold py-4 px-8 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg">
              ⚫ Download Black & White
            </button>
          </div>
        </div>

        <!-- Modern Template -->
        <div class="bg-gray-900 rounded-3xl p-8 border-2 border-green-600 hover:border-green-400 transition-all duration-300 transform hover:scale-105">
          <div class="mb-8">
            <h3 class="text-3xl font-bold text-green-400 mb-4">Modern Template</h3>
            <p class="text-gray-300 text-lg leading-relaxed">Contemporary design with creative elements, perfect for tech, startups, marketing, and creative industries.</p>
          </div>
          <div class="bg-white rounded-xl p-6 mb-8 h-80 overflow-hidden shadow-lg">
            <div class="flex h-full">
              <div class="w-1/3 bg-green-600 text-white p-3 rounded-l-lg">
                {% if resume.photo_path %}
                <div class="w-full h-20 bg-gray-300 rounded-full mx-auto mb-3"></div>
                {% endif %}
                <div class="text-center text-xs">
                  <div class="font-bold mb-2">MODERN NAME</div>
                  <div class="mb-3">SKILLS</div>
                  <div class="text-xs">• Enhanced Skills</div>
                  <div class="text-xs">• AI Optimized</div>
                  <div class="text-xs">• Professional</div>
                </div>
              </div>
              <div class="w-2/3 p-4 text-gray-800">
                <div class="font-bold text-green-600 border-b border-green-300 pb-1 mb-2 text-sm">ABOUT</div>
                <div class="text-gray-600 mb-3 text-xs leading-relaxed">{{ resume.text_content|truncate(100) }}</div>
                <div class="font-bold text-green-600 border-b border-green-300 pb-1 mb-2 text-sm">EXPERIENCE</div>
                <div class="text-gray-600 text-xs">Modern format with enhanced content...</div>
              </div>
            </div>
          </div>
          <div class="space-y-4">
            <button onclick="downloadTemplate('modern', 'color')" class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold py-4 px-8 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg">
              🎨 Download with Modern Colors
            </button>
            <button onclick="downloadTemplate('modern', 'bw')" class="w-full bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-bold py-4 px-8 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg">
              ⚫ Download Black & White
            </button>
          </div>
        </div>

        <!-- Creative Template -->
        <div class="bg-gray-900 rounded-3xl p-8 border-2 border-purple-600 hover:border-purple-400 transition-all duration-300 transform hover:scale-105">
          <div class="mb-8">
            <h3 class="text-3xl font-bold text-purple-400 mb-4">Creative Template</h3>
            <p class="text-gray-300 text-lg leading-relaxed">Bold, artistic design for creative professionals, designers, artists, and portfolio-based careers.</p>
          </div>
          <div class="bg-white rounded-xl p-6 mb-8 h-80 overflow-hidden shadow-lg">
            <div class="bg-gradient-to-r from-purple-600 via-pink-600 to-purple-700 text-white p-4 rounded-t-lg text-center">
              <div class="font-bold text-lg mb-2">CREATIVE NAME</div>
              {% if resume.photo_path %}
              <div class="w-20 h-20 bg-gray-300 rounded-full mx-auto"></div>
              {% endif %}
            </div>
            <div class="p-4 text-gray-800">
              <div class="grid grid-cols-2 gap-3">
                <div>
                  <div class="font-bold text-purple-600 mb-2 text-sm">CREATIVE SUMMARY</div>
                  <div class="text-gray-600 text-xs leading-relaxed">{{ resume.text_content|truncate(80) }}</div>
                </div>
                <div>
                  <div class="font-bold text-purple-600 mb-2 text-sm">PORTFOLIO</div>
                  <div class="text-gray-600 text-xs">Creative achievements and projects...</div>
                </div>
              </div>
            </div>
          </div>
          <div class="space-y-4">
            <button onclick="downloadTemplate('creative', 'color')" class="w-full bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white font-bold py-4 px-8 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg">
              🎨 Download with Creative Colors
            </button>
            <button onclick="downloadTemplate('creative', 'bw')" class="w-full bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-bold py-4 px-8 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg">
              ⚫ Download Black & White
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Extra PDF Download Buttons -->
  <div class="template-options grid grid-cols-1 md:grid-cols-3 gap-8 my-8">
    <button onclick="downloadTemplate('professional', 'color')" class="btn-template">Download Professional PDF</button>
    <button onclick="downloadTemplate('modern', 'color')" class="btn-template">Download Modern PDF</button>
    <button onclick="downloadTemplate('creative', 'color')" class="btn-template">Download Creative PDF</button>
  </div>

  <!-- Photo Integration Section -->
  <div class="bg-gray-900 rounded-3xl p-12 border-2 border-orange-600 mb-16">
    <div class="text-center mb-10">
      <h3 class="text-4xl font-bold text-orange-400 mb-6">📸 Photo Integration Options</h3>
      <p class="text-xl text-gray-300 max-w-3xl mx-auto">Choose how your profile photo appears in your selected resume template</p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
      <!-- Photo integration options (add your content here) -->
      <input type="file" id="newPhoto" accept="image/*" class="hidden">
    </div>
  </div>

  <!-- Enhanced Resume Preview -->
  <div class="bg-gray-900 rounded-3xl p-12 border-2 border-gray-600">
    <div class="text-center mb-10">
      <h3 class="text-4xl font-bold text-white mb-6">Enhanced Resume Content Preview</h3>
      <p class="text-xl text-gray-400">Your AI-enhanced content that will be used in all templates</p>
    </div>
    <div class="bg-white rounded-2xl p-8 text-gray-900 max-h-96 overflow-y-auto">
      <div class="prose prose-lg max-w-none">
        <div id="enhanced-content" class="whitespace-pre-wrap font-serif leading-relaxed text-lg md:text-xl" style="font-size: 1.25rem; line-height: 2; min-height: 120px;">
          {{ html_content | safe }}
        </div>
      </div>
    </div>
  </div>

  <!-- Enhancement Features Grid -->
  <div class="max-w-7xl mx-auto px-6 py-20">
    <div class="text-center mb-16">
      <h2 class="text-5xl font-bold text-green-400 mb-6">✨ AI Enhancement Features Applied</h2>
      <p class="text-xl text-gray-400 max-w-3xl mx-auto">Professional standards applied to optimize your resume for global opportunities</p>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
      <!-- Add feature cards here if desired -->
    </div>
  </div>

  <!-- Additional Actions Section -->
  <div class="bg-gray-900 py-20 px-6">
    <div class="max-w-6xl mx-auto text-center">
      <h3 class="text-4xl font-bold text-white mb-12">Additional Actions</h3>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
        <button onclick="copyToClipboard()" class="group bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-semibold py-8 px-10 rounded-2xl transition-all duration-300 transform hover:scale-105 shadow-xl">
          <div class="flex flex-col items-center">
            <svg class="w-16 h-16 mb-4 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
            </svg>
            <span class="text-xl font-bold">Copy Text</span>
            <span class="text-base opacity-80 mt-1">Copy enhanced content</span>
          </div>
        </button>
        <a href="{{ url_for('my_resumes') }}" class="group bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-semibold py-8 px-10 rounded-2xl transition-all duration-300 transform hover:scale-105 shadow-xl">
          <div class="flex flex-col items-center">
            <svg class="w-16 h-16 mb-4 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            <span class="text-xl font-bold">All Resumes</span>
            <span class="text-base opacity-80 mt-1">View collection</span>
          </div>
        </a>
        <a href="{{ url_for('cover_letter') }}" class="group bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white font-semibold py-8 px-10 rounded-2xl transition-all duration-300 transform hover:scale-105 shadow-xl">
          <div class="flex flex-col items-center">
            <svg class="w-16 h-16 mb-4 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
            </svg>
            <span class="text-xl font-bold">Cover Letter</span>
            <span class="text-base opacity-80 mt-1">Create matching letter</span>
          </div>
        </a>
        <a href="{{ url_for('home') }}" class="group bg-gradient-to-r from-gray-700 to-gray-800 hover:from-gray-600 hover:to-gray-700 text-white font-semibold py-8 px-10 rounded-2xl transition-all duration-300 transform hover:scale-105 shadow-xl">
          <div class="flex flex-col items-center">
            <svg class="w-16 h-16 mb-4 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
            </svg>
            <span class="text-xl font-bold">Home</span>
            <span class="text-base opacity-80 mt-1">Back to dashboard</span>
          </div>
        </a>
      </div>
    </div>
  </div>
</div>

<script>
// AI Typing Animation - Enhanced Messages
const typingMessages = [
  "🔍 Analyzing original resume content and structure...",
  "📊 Extracting candidate qualifications and experience...",
  "🎯 Identifying content optimization opportunities...",
  "💼 Applying worldwide professional standards...",
  "📝 Enhancing language while preserving original meaning...",
  "📈 Optimizing for ATS compatibility globally...",
  "🎨 Generating multiple professional template options...",
  "🖼️ Preparing photo integration capabilities...",
  "📄 Setting up PDF export with template variations...",
  "✅ Enhancement complete! Multiple templates ready for download."
];

let currentMessageIndex = 0;
let currentCharIndex = 0;

function typeMessage() {
  if (currentMessageIndex >= typingMessages.length) {
    document.getElementById('cursor').style.display = 'none';
    // Now start typing the actual resume content, paragraph by paragraph
    typeParagraphs({{ resume.text_content|tojson }}, 'enhanced-content', 10, 400);
    return;
  }

  const container = document.getElementById('typing-container');
  const currentMessage = typingMessages[currentMessageIndex];

  if (currentCharIndex === 0) {
    const newLine = document.createElement('div');
    newLine.className = 'mb-3';
    newLine.id = `line-${currentMessageIndex}`;
    container.appendChild(newLine);
  }

  const currentLine = document.getElementById(`line-${currentMessageIndex}`);

  if (currentCharIndex < currentMessage.length) {
    currentLine.textContent += currentMessage[currentCharIndex];
    currentCharIndex++;
    setTimeout(typeMessage, Math.random() * 50 + 30);
  } else {
    currentMessageIndex++;
    currentCharIndex = 0;
    setTimeout(typeMessage, 1000);
  }
}

// Typewriter effect for the enhanced resume content, paragraph by paragraph
function typeParagraphs(text, targetId, speed = 30, paragraphDelay = 400) {
  let paragraphs = text.split(/\n\s*\n/);
  if (paragraphs.length === 1) {
    paragraphs = text.split('\n');
  }
  const target = document.getElementById(targetId);
  target.innerHTML = '';
  let pIndex = 0;

  function typeParagraph() {
    if (pIndex >= paragraphs.length) return;
    const p = document.createElement('p');
    p.className = "mb-4";
    target.appendChild(p);
    let charIndex = 0;
    let paragraph = paragraphs[pIndex];

    function typeChar() {
      if (charIndex < paragraph.length) {
        p.innerHTML += paragraph.charAt(charIndex);
        charIndex++;
        setTimeout(typeChar, speed);
      } else {
        pIndex++;
        setTimeout(typeParagraph, paragraphDelay);
      }
    }
    typeChar();
  }
  typeParagraph();
}

window.addEventListener('load', function() {
  setTimeout(typeMessage, 1500);
});

function showNotification(message, type) {
  const notification = document.createElement('div');
  let bgColor = 'bg-blue-600';
  if (type === 'success') bgColor = 'bg-green-600';
  if (type === 'error') bgColor = 'bg-red-600';
  if (type === 'warning') bgColor = 'bg-yellow-600';
  if (type === 'info') bgColor = 'bg-blue-600';

  notification.className = `fixed top-8 right-8 ${bgColor} text-white px-8 py-6 rounded-xl shadow-2xl z-50 transform transition-all duration-300 translate-x-full`;
  notification.innerHTML = `
    <div class="flex items-center">
      <span class="text-xl font-medium">${message}</span>
    </div>
  `;

  document.body.appendChild(notification);

  setTimeout(() => {
    notification.style.transform = 'translateX(0)';
  }, 100);

  setTimeout(() => {
    notification.style.transform = 'translateX(100%)';
    setTimeout(() => {
      if (document.body.contains(notification)) {
        document.body.removeChild(notification);
      }
    }, 300);
  }, 4000);
}

// PDF Download with Template/Color Selection for Enhanced Resume
function downloadTemplate(templateType, colorOption) {
  const resumeContent = {{ resume_markdown | tojson | safe }};
  const userInfo = {
    name: "{{ current_user.name }}",
    email: "{{ current_user.email }}"
  };
  fetch("{{ url_for('download_template_pdf') }}", {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      template: templateType,
      colorOption: colorOption,
      content: resumeContent,
      isMarkdown: true,
      userInfo: userInfo
    })
  })
  .then(response => {
    if (!response.ok) throw new Error('Network response was not ok');
    return response.blob();
  })
  .then(blob => {
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.style.display = 'none';
    a.href = url;
    a.download = `Resume_${templateType}_${colorOption}_${new Date().toISOString().slice(0, 10)}.pdf`;
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
    showNotification('📄 Professional resume downloaded successfully!', 'success');
  })
  .catch(error => {
    alert('Failed to download PDF. Please try again.');
  });
}

function downloadTextFallback(templateType, colorOption) {
  const resumeContent = document.getElementById('enhanced-content').innerText;
  const blob = new Blob([resumeContent], { type: 'text/plain;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const timestamp = new Date().toISOString().slice(0, 10);
  a.href = url;
  a.download = `Enhanced_${templateType}_${colorOption}_Resume_${timestamp}.txt`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

function copyToClipboard() {
  const resumeContent = document.getElementById('enhanced-content').innerText;
  navigator.clipboard.writeText(resumeContent).then(function() {
    showNotification('Enhanced resume content copied to clipboard!', 'success');
  }).catch(function() {
    showNotification('Failed to copy. Please select and copy manually.', 'error');
  });
}

document.getElementById('newPhoto').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (file) {
    showNotification('📸 New photo selected! Use template download buttons to generate resumes with your new photo.', 'info');
  }
});
</script>
{% endblock %}
