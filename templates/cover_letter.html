{% extends 'base.html' %}

{% block title %}AI Cover Letter Generator - Career Coach{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-900 text-white">

  <!-- Professional Header Section -->
  <div class="bg-gradient-to-r from-orange-800 via-orange-700 to-red-800 py-20 px-6">
    <div class="max-w-7xl mx-auto text-center">
      <div class="inline-flex items-center justify-center w-24 h-24 bg-white rounded-full mb-8 animate-pulse">
        <svg class="w-12 h-12 text-orange-600" fill="currentColor" viewBox="0 0 24 24">
          <path d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586l-2 2V6H5v12h14v-2.586l2-2V18a1 1 0 01-1 1H4a1 1 0 01-1-1V4z"/>
          <path d="M11 6a1 1 0 00-.707.293l-4 4a1 1 0 101.414 1.414L11 8.414V15a1 1 0 102 0V8.414l3.293 3.293a1 1 0 001.414-1.414l-4-4A1 1 0 0013 6h-2z"/>
        </svg>
      </div>
      <h1 class="text-6xl md:text-7xl font-bold text-white mb-6 leading-tight">
        üìù AI Cover Letter
        <span class="block text-orange-300 mt-2">Generator</span>
      </h1>
      <p class="text-2xl md:text-3xl text-orange-100 max-w-4xl mx-auto leading-relaxed">
        Create compelling, personalized cover letters that perfectly match your resume and target job requirements with AI precision.
      </p>
    </div>
  </div>

  <!-- AI Enhancement Promise -->
  <div class="bg-gray-800 py-16 px-6">
    <div class="max-w-5xl mx-auto">
      <div class="bg-blue-900 border border-blue-600 p-10 rounded-3xl text-center shadow-2xl">
        <div class="flex items-center justify-center mb-6">
          <svg class="w-10 h-10 text-blue-300 mr-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
          </svg>
          <h2 class="text-3xl font-bold text-blue-300">ü§ñ AI-Powered Cover Letter Creation</h2>
        </div>
        <p class="text-xl text-gray-300 max-w-3xl mx-auto leading-relaxed">
          Our advanced AI analyzes your experience and the job requirements to create a compelling, personalized cover letter that stands out to hiring managers worldwide.
        </p>
      </div>
    </div>
  </div>

  <!-- Cover Letter Form Section -->
  <div class="bg-gray-800 py-20 px-6">
    <div class="max-w-5xl mx-auto">
      <div class="text-center mb-16">
        <h2 class="text-5xl font-bold text-white mb-6">Generate Your Professional Cover Letter</h2>
        <p class="text-xl text-gray-400 max-w-3xl mx-auto">Provide your details below and let AI create a tailored cover letter for your job application</p>
      </div>

      <!-- Error Messages -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="bg-red-900 border border-red-600 text-red-300 px-8 py-6 rounded-2xl mb-10 text-center shadow-lg">
              <svg class="w-6 h-6 inline mr-3" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
              </svg>
              <span class="text-lg font-medium">{{ message }}</span>
            </div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <!-- Professional Form -->
      <form method="POST" class="bg-gray-900 p-12 rounded-3xl shadow-2xl border border-gray-700" onsubmit="showProcessing()">

        <!-- Model Selection Dropdown - ADDED -->
        <div class="mb-10">
          <label for="model" class="block text-2xl font-semibold text-white mb-2">Choose AI Model</label>
          <select
            name="model"
            id="model"
            class="w-full px-8 py-4 rounded-2xl bg-gray-700 text-white border-2 border-gray-600 focus:border-yellow-400 focus:ring-4 focus:ring-yellow-400 focus:ring-opacity-30 transition-all duration-300 text-lg"
            required
          >
            <option value="gpt-4.1-mini" {% if selected_model == 'gpt-4.1-mini' %}selected{% endif %}>GPT-4.1 Mini</option>
            <option value="gpt-4o-mini" {% if selected_model == 'gpt-4o-mini' or not selected_model %}selected{% endif %}>GPT-4.0 Mini</option>
          </select>
        </div>

        <!-- Name and Address Section -->
        <div class="mb-10">
          <label for="address" class="block text-2xl font-semibold text-white mb-6 flex items-center">
            <svg class="w-8 h-8 mr-3 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 2a6 6 0 016 6c0 4.418-6 10-6 10S4 12.418 4 8a6 6 0 016-6zm0 8a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
            </svg>
            Your Name and Address
          </label>
          <textarea
            id="address"
            name="address"
            rows="4"
            required
            class="w-full px-8 py-6 rounded-2xl bg-gray-700 text-white border-2 border-gray-600 focus:border-yellow-400 focus:ring-4 focus:ring-yellow-400 focus:ring-opacity-30 transition-all duration-300 text-lg leading-relaxed"
            placeholder="Jane Doe
123 Main St
Apt 4B
Springfield, IL 62704"
          ></textarea>
          <p class="text-sm text-gray-400 mt-3 flex items-center">
            <svg class="w-4 h-4 mr-2 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zm-2 3a1 1 0 100 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
            </svg>
            üí° Tip: Start with your full name on the first line, followed by your address. Press Enter for a new line.
          </p>
        </div>

        <!-- Email Section -->
        <div class="mb-10">
          <label class="block text-2xl font-semibold text-white mb-2">Your Email</label>
          <input
            type="email"
            name="email"
            required
            class="w-full px-8 py-4 rounded-2xl bg-gray-700 text-white border-2 border-gray-600 focus:border-blue-400 focus:ring-4 focus:ring-blue-400 focus:ring-opacity-30 transition-all duration-300 text-lg"
            placeholder="you@example.com"
            value="{{ email or '' }}"
          />
        </div>

        <!-- Phone Number Section -->
        <div class="mb-10">
          <label class="block text-2xl font-semibold text-white mb-2">Your Phone Number</label>
          <input
           type="text"
          name="phone"
          class="w-full px-8 py-4 rounded-2xl bg-gray-700 text-white border-2 border-gray-600 focus:border-green-400 focus:ring-4 focus:ring-green-400 focus:ring-opacity-30 transition-all duration-300 text-lg"
          placeholder="+1 555 123 4567"
           value="{{ phone or '' }}"
          />
        </div>

        <!-- Resume Summary Section -->
        <div class="mb-10">
          <label class="block text-2xl font-semibold text-white mb-6 flex items-center">
            <svg class="w-8 h-8 mr-3 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"></path>
            </svg>
            Your Resume Summary
          </label>
          <textarea
            name="resume_text"
            rows="7"
            required
            class="w-full px-8 py-6 rounded-2xl bg-gray-700 text-white border-2 border-gray-600 focus:border-orange-500 focus:ring-4 focus:ring-orange-500 focus:ring-opacity-30 transition-all duration-300 text-lg leading-relaxed"
            placeholder="Paste your resume content, key skills, and work experience here. Include your most relevant qualifications and achievements that demonstrate your value to employers..."
          ></textarea>
          <p class="text-sm text-gray-400 mt-3 flex items-center">
            <svg class="w-4 h-4 mr-2 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zm-2 3a1 1 0 100 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
            </svg>
            üí° Tip: Include your most relevant skills, experience, and quantifiable achievements
          </p>
        </div>

        <!-- Job Information Section -->
        <div class="mb-12">
          <label class="block text-2xl font-semibold text-white mb-6 flex items-center">
            <svg class="w-8 h-8 mr-3 text-green-500" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M6 6V5a3 3 0 013-3h2a3 3 0 013 3v1h2a2 2 0 012 2v3.57A22.952 22.952 0 0110 13a22.95 22.95 0 01-8-1.43V8a2 2 0 012-2h2zm2-1a1 1 0 011-1h2a1 1 0 011 1v1H8V5zm1 5a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1z" clip-rule="evenodd"></path>
            </svg>
            Job Information
          </label>
          <textarea
            name="job_info"
            rows="6"
            required
            class="w-full px-8 py-6 rounded-2xl bg-gray-700 text-white border-2 border-gray-600 focus:border-green-500 focus:ring-4 focus:ring-green-500 focus:ring-opacity-30 transition-all duration-300 text-lg leading-relaxed"
            placeholder="Enter the job title, company name, key requirements, and any specific qualifications mentioned in the job posting. Include details about the company culture, values, and what they're looking for in an ideal candidate..."
          ></textarea>
          <p class="text-sm text-gray-400 mt-3 flex items-center">
            <svg class="w-4 h-4 mr-2 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zm-2 3a1 1 0 100 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
            </svg>
            üí° Tip: Include job title, company name, and key requirements from the job posting
          </p>
        </div>

        <!-- Generate Button -->
        <div class="text-center">
          <button type="submit" class="bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-bold py-6 px-16 rounded-3xl text-2xl transition-all duration-300 transform hover:scale-105 shadow-2xl">
            <svg class="w-8 h-8 inline mr-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
            </svg>
            <span id="generate-text">üöÄ Generate Professional Cover Letter</span>
            <span id="processing-text" class="hidden">‚è≥ AI is crafting your cover letter...</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Generated Cover Letter Display -->
  {% if letter %}
  <div class="bg-gray-800 py-20 px-6">
    <div class="max-w-6xl mx-auto">
      <div class="text-center mb-16">
        <h2 class="text-5xl font-bold text-green-400 mb-6">‚úÖ Your Professional Cover Letter</h2>
        <p class="text-2xl text-gray-400">AI-generated and tailored to your specific job application</p>
      </div>
      <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
        <div class="bg-gradient-to-r from-gray-50 to-gray-100 px-10 py-8 border-b border-gray-200">
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
              <div class="w-5 h-5 bg-red-500 rounded-full"></div>
              <div class="w-5 h-5 bg-yellow-500 rounded-full"></div>
              <div class="w-5 h-5 bg-green-500 rounded-full"></div>
            </div>
            <div class="flex items-center space-x-4">
              <span class="text-lg text-gray-600 font-medium">Professional Cover Letter</span>
              <div class="flex items-center space-x-2">
                <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                <span class="text-sm text-green-600 font-semibold">READY</span>
              </div>
            </div>
          </div>
        </div>
        <div class="p-16 bg-white text-gray-900">
          <div class="max-w-4xl mx-auto">
            <div class="prose prose-xl max-w-none">
              <div id="ai-typing-container"
                   class="whitespace-pre-wrap font-serif leading-relaxed text-2xl md:text-3xl text-gray-800 min-h-[400px]"
                   style="font-size: 1.5rem; line-height: 2.2;">
              </div>
              <span id="ai-typing-cursor" class="text-green-500 animate-pulse text-2xl font-bold">|</span>
              <div id="ai-final-html" class="hidden">
                {{ letter | safe }}
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 mt-16">
        <button onclick="copyToClipboard()" class="group bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-semibold py-8 px-10 rounded-2xl transition-all duration-300 transform hover:scale-105 shadow-xl">
          <div class="flex flex-col items-center">
            <svg class="w-16 h-16 mb-4 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
            </svg>
            <span class="text-xl font-bold">Copy Text</span>
            <span class="text-base opacity-75">Copy to clipboard</span>
          </div>
        </button>
        <button onclick="downloadCoverLetter()" class="group bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white font-semibold py-8 px-10 rounded-2xl transition-all duration-300 transform hover:scale-105 shadow-xl">
          <div class="flex flex-col items-center">
            <svg class="w-16 h-16 mb-4 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            <span class="text-xl font-bold">Download Markdown</span>
            <span class="text-base opacity-75">Save as .md file</span>
          </div>
        </button>
        <button onclick="downloadTemplatePDF('cover_letter')" class="group bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold py-8 px-10 rounded-2xl transition-all duration-300 transform hover:scale-105 shadow-xl">
          <div class="flex flex-col items-center">
            <svg class="w-16 h-16 mb-4 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            <span class="text-xl font-bold">Download PDF</span>
            <span class="text-base opacity-75">Save as PDF file</span>
          </div>
        </button>
        <button onclick="generateAnother()" class="group bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white font-semibold py-8 px-10 rounded-2xl transition-all duration-300 transform hover:scale-105 shadow-xl">
          <div class="flex flex-col items-center">
            <svg class="w-16 h-16 mb-4 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
            <span class="text-xl font-bold">Generate Another</span>
            <span class="text-base opacity-75">Create new version</span>
          </div>
        </button>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Cover Letter Tips Section -->
  <div class="bg-gray-900 py-20 px-6">
    <div class="max-w-7xl mx-auto">
      <div class="text-center mb-16">
        <h2 class="text-5xl font-bold text-white mb-6">üí° Cover Letter Best Practices</h2>
        <p class="text-xl text-gray-400">Tips to make your cover letter stand out to hiring managers worldwide</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
        <div class="bg-gray-800 rounded-3xl p-10 border border-gray-700 hover:border-blue-500 transition-all duration-300 transform hover:scale-105">
          <div class="text-center mb-8">
            <div class="w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-6">
              <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <h3 class="text-2xl font-bold text-white">Customize for Each Job</h3>
          </div>
          <p class="text-gray-300 text-center text-lg leading-relaxed">Tailor your cover letter to match the specific job requirements and company culture for maximum impact.</p>
        </div>
        <div class="bg-gray-800 rounded-3xl p-10 border border-gray-700 hover:border-green-500 transition-all duration-300 transform hover:scale-105">
          <div class="text-center mb-8">
            <div class="w-20 h-20 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-6">
              <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
              </svg>
            </div>
            <h3 class="text-2xl font-bold text-white">Show Specific Examples</h3>
          </div>
          <p class="text-gray-300 text-center text-lg leading-relaxed">
            Include quantifiable achievements and specific examples that demonstrate your value to potential employers.
          </p>
        </div>
        <div class="bg-gray-800 rounded-3xl p-10 border border-gray-700 hover:border-purple-500 transition-all duration-300 transform hover:scale-105">
          <div class="text-center mb-8">
            <div class="w-20 h-20 bg-purple-600 rounded-full flex items-center justify-center mx-auto mb-6">
              <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 20 20">
                <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"></path>
              </svg>
            </div>
            <h3 class="text-2xl font-bold text-white">Keep It Professional</h3>
          </div>
          <p class="text-gray-300 text-center text-lg leading-relaxed">Maintain a professional tone while showing enthusiasm and letting your personality shine through appropriately.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function showProcessing() {
  document.getElementById('generate-text').classList.add('hidden');
  document.getElementById('processing-text').classList.remove('hidden');
}

{% if letter_markdown %}
const fullLetter = {{ letter_markdown | default('') | tojson | safe }};
const container = document.getElementById('ai-typing-container');
const cursor = document.getElementById('ai-typing-cursor');
const finalHtml = document.getElementById('ai-final-html');
let typingSpeed = 30;

let paragraphs = fullLetter.split(/\n\s*\n/);
if (paragraphs.length === 1) {
  paragraphs = fullLetter.split('\n');
}

container.innerHTML = '';
let pIndex = 0;

function typeParagraph() {
  if (pIndex >= paragraphs.length) {
    setTimeout(() => {
      cursor.style.display = 'none';
      container.classList.add('hidden');
      finalHtml.classList.remove('hidden');
    }, 500);
    return;
  }
  const p = document.createElement('p');
  p.className = "mb-6";
  p.style.fontSize = "1.5rem";
  p.style.lineHeight = "2.2";
  container.appendChild(p);
  let charIndex = 0;
  let paragraph = paragraphs[pIndex];

  function typeChar() {
    if (charIndex < paragraph.length) {
      p.textContent += paragraph.charAt(charIndex);
      charIndex++;
      setTimeout(typeChar, typingSpeed);
    } else {
      pIndex++;
      setTimeout(typeParagraph, 400);
    }
  }
  typeChar();
}

setTimeout(typeParagraph, 1000);
{% endif %}

function copyToClipboard() {
  const coverLetterText = {{ letter_markdown | default('') | tojson | safe }};
  navigator.clipboard.writeText(coverLetterText).then(function() {
    showNotification('Cover letter copied to clipboard successfully!', 'success');
  }).catch(function() {
    showNotification('Failed to copy. Please select and copy manually.', 'error');
  });
}

function downloadCoverLetter() {
  const coverLetterText = {{ letter_markdown | default('') | tojson | safe }};
  const blob = new Blob([coverLetterText], { type: 'text/plain;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const timestamp = new Date().toISOString().slice(0, 10);

  a.href = url;
  a.download = `Professional_Cover_Letter_${timestamp}.md`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);

  showNotification('üìÑ Cover letter downloaded successfully!', 'success');
}

function generateAnother() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
  document.querySelector('textarea[name="resume_text"]').focus();
}

function showNotification(message, type) {
  const notification = document.createElement('div');
  const bgColor = type === 'success' ? 'bg-green-600' : 'bg-red-600';

  notification.className = `fixed top-8 right-8 ${bgColor} text-white px-8 py-6 rounded-2xl shadow-2xl z-50 transform transition-all duration-300 translate-x-full`;
  notification.innerHTML = `
    <div class="flex items-center">
      <span class="text-xl font-medium">${message}</span>
    </div>
  `;

  document.body.appendChild(notification);

  setTimeout(() => {
    notification.style.transform = 'translateX(0)';
  }, 100);

  setTimeout(() => {
    notification.style.transform = 'translateX(100%)';
    setTimeout(() => {
      if (document.body.contains(notification)) {
        document.body.removeChild(notification);
      }
    }, 300);
  }, 4000);
}

function downloadTemplatePDF(docType) {
  const content = docType === 'cover_letter'
    ? {{ letter_markdown | default('') | tojson | safe }}
    : {{ resume_markdown | default('') | tojson | safe }};
  const userInfo = {
  address: document.querySelector('[name="address"]').value,
  email: document.querySelector('[name="email"]').value,
  phone: document.querySelector('[name="phone"]').value,
  date: new Date().toLocaleDateString('en-GB', { day: '2-digit', month: 'long', year: 'numeric' })
};

  fetch('/download-template-pdf', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      template: window.selectedTemplate || 'professional',
      colorOption: window.selectedColorOption || 'color',
      docType: docType,
      content: content,
      isMarkdown: true,
      userInfo: userInfo
    })
  })
  .then(response => {
    if (!response.ok) throw new Error('Network response was not ok');
    return response.blob();
  })
  .then(blob => {
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.style.display = 'none';
    a.href = url;
    a.download = `${docType}_${window.selectedTemplate || 'professional'}_${new Date().toISOString().slice(0, 10)}.pdf`;
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);

    const emailDiv = document.getElementById('email-container');
    if (emailDiv) {
      emailDiv.style.display = 'none';
    }

    showNotification('üìÑ PDF downloaded successfully!', 'success');
  })
  .catch(error => {
    showNotification('Failed to download PDF. Please try again.', 'error');
  });
}
</script>
{% endblock %}
